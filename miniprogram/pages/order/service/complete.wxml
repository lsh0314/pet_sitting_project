<view class="container">
  <!-- 顶部导航栏 -->
  <view class="nav-bar">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">←</text>
    </view>
    <view class="page-title">服务完成打卡</view>
  </view>

  <!-- 页面内容 -->
  <view class="content" wx:if="{{!loading && orderInfo}}">
    <view class="card">
      <view class="card-title">服务信息</view>
      <view class="info-item">
        <view class="info-label">服务类型</view>
        <view class="info-value">
          <text wx:if="{{orderInfo.serviceType === 'walk'}}">遛狗</text>
          <text wx:elif="{{orderInfo.serviceType === 'feed'}}">喂食</text>
          <text wx:else>寄养</text>
        </view>
      </view>
      <view class="info-item">
        <view class="info-label">宠物名称</view>
        <view class="info-value">{{orderInfo.pet.name}}</view>
      </view>
      <view class="info-item">
        <view class="info-label">服务地址</view>
        <view class="info-value">{{orderInfo.address}}</view>
      </view>
    </view>

    <!-- 位置验证 -->
    <view class="card">
      <view class="card-title">位置验证</view>
      <view class="location-status {{locationVerified ? 'success' : ''}}">
        <view class="status-text">{{locationMessage || '请验证您的位置'}}</view>
        <view class="distance-text" wx:if="{{distance !== null}}">
          距离服务地点: {{distance > 1000 ? distanceDisplay + '公里' : distance + '米'}}
        </view>
      </view>
      <button class="btn-verify {{locationChecking ? 'loading' : ''}}" bindtap="verifyLocation" disabled="{{locationChecking}}">
        {{locationVerified ? '重新验证位置' : '验证位置'}}
      </button>
    </view>

    <!-- 拍照打卡 -->
    <view class="card">
      <view class="card-title">拍照打卡</view>
      <view class="photo-area">
        <block wx:if="{{!photoTaken}}">
          <view class="photo-placeholder" bindtap="takePhoto">
            <view class="placeholder-icon">+</view>
            <view class="placeholder-text">点击拍照</view>
          </view>
        </block>
        <block wx:else>
          <image class="photo-preview" src="{{photoPath}}" mode="aspectFill"></image>
          <view class="photo-actions">
            <button class="btn-retake" bindtap="retakePhoto">重新拍照</button>
          </view>
        </block>
      </view>
    </view>

    <!-- 提交按钮 -->
    <button 
      class="btn-submit {{(photoTaken && locationVerified) ? '' : 'disabled'}}" 
      bindtap="completeService"
      disabled="{{!photoTaken || !locationVerified || uploading}}">
      {{uploading ? '提交中...' : '完成服务'}}
    </button>
  </view>

  <!-- 加载中状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <text>正在加载...</text>
  </view>
  
  <!-- 错误状态 -->
  <view class="error-container" wx:if="{{error}}">
    <icon type="warn" size="64"></icon>
    <text>加载失败，请重试</text>
    <button class="btn-retry" bindtap="getOrderDetail">重新加载</button>
  </view>
</view> 